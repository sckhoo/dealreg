<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Details</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <link rel="stylesheet" href="/admin.css">
    </head>
    <body>
        <nav>
            <h4>AVM DealReg Administration Page</h4>
            <ul>
                <Li><a href="/avmlogin">Home</a></Li>
                <Li><a href="/avmdownload">Download CSV</a></Li>
            </ul>
        </nav>

        <div class="label">
            <p class="user" id="user"><b>Welcome, <%=email %></b></p>
        </div>


        <div class="label">
            <label for="pending"><b>Pending</b></label>
            <hr>
            <div class="deals">
                <table class="table table-hover">
                    
                    <tr>
                        <th>Deal No.</th>
                        <th>Client</th>
                        <th>OppName</th>
                        <th>Reseller</th>
                        <th>Added On</th>
                    </tr>
        

                    <tbody>
                        <% if (deal.length > 0) { %>
                            <% deal.forEach(deal => { %>
                                <% if (deal.dealRegStatus === 'pending') { %>
                                    <tr>
                                        <th data-href="/admin/<%= deal.dealNo %>/<%=email %>"><%= deal.dealNo %></th>
                                        <th><%= deal.custName %></th>
                                        <th><%= deal.oppName %></th>
                                        <th><%= deal.submitterReseller %></th>
                                        <th><%= deal.dealRegSubmitDate %></th>
                                    </tr>
                                <% } %>
                            <% }) %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="label">
            <label for="accept"><b>Accepted</b></label>
            <hr>
            <div class="deals">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Deal No.</th>
                            <th>Client</th>
                            <th>OppName</th>
                            <th>Reseller</th>
                            <th>Added On</th>
                        </tr>
                    </thead>
                    <tbody id="acceptTable">
                        <% if (deal.length > 0) { %>
                            <% deal.forEach(deal => { %>
                                <% if (deal.dealRegStatus === 'accept') { %>
                                    <th data-href="/admin/<%= deal.dealNo %>/<%=email %>"><%= deal.dealNo %></th>
                                    <th><%= deal.custName %></th>
                                    <th><%= deal.oppName %></th>
                                    <th><%= deal.submitterReseller %></th>
                                    <th><%= deal.dealRegSubmitDate %></th>
                                        
                                    </tr>
                                <% } %>
                            <% }) %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="label">
            <label for="reject"><b>Rejected</b></label>
            <hr>
            <div class="deals">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Deal No.</th>
                            <th>Client</th>
                            <th>OppName</th>
                            <th>Reseller</th>
                            <th>Added On</th>
                        </tr>
                    </thead>

                    <tbody id="rejectTable">
                        <% if (deal.length > 0) { %>
                            <% deal.forEach(deal => { %>
                                <% if (deal.dealRegStatus === 'reject') { %>
                                    <tr>
                                        <th data-href="/admin/<%= deal.dealNo %>/<%=email %>"><%= deal.dealNo %></th>
                                        <th><%= deal.custName %></th>
                                        <th><%= deal.oppName %></th>
                                        <th><%= deal.submitterReseller %></th>
                                        <th><%= deal.dealRegSubmitDate %></th>
                                    </tr>
                                <% } %>
                            <% }) %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="label">
            <label for="close"><b>Closed</b></label>
            <hr>
            <div class="deals">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Deal No.</th>
                            <th>Client</th>
                            <th>OppName</th>
                            <th>Reseller</th>
                            <th>Added On</th>
                        </tr>
                    </thead>

                    <tbody id="rejectTable">
                        <% if (deal.length > 0) { %>
                            <% deal.forEach(deal => { %>
                                <% if (deal.dealRegStatus === 'closed') { %>
                                    <tr>
                                        <th data-href="/admin/<%= deal.dealNo %>/<%=email %>"><%= deal.dealNo %></th>
                                        <th><%= deal.custName %></th>
                                        <th><%= deal.oppName %></th>
                                        <th><%= deal.submitterReseller %></th>
                                        <th><%= deal.dealRegSubmitDate %></th>
                                    </tr>
                                <% } %>
                            <% }) %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <script>
           

            document.addEventListener("DOMContentLoaded", () => {
                const rows = document.querySelectorAll("th[data-href");

                rows.forEach(row => {
                    row.addEventListener('click', () => {
                        window.location.href = row.dataset.href;
                    });
                });
            });

            
    </script>
    </body>
</html>
